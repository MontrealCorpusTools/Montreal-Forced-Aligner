language: python
python:
  - 3.5
branches:
  only:
    - master
notifications:
  email: false

sudo: required

services:
  - docker

before_install:
  - docker run -d --name ubuntu-test -v $(pwd):/travis ubuntu:latest tail -f /dev/null
  - docker ps

# Install packages
install:
  - docker exec -t ubuntu-test bash -c "apt-get update;
    rm -rf /dev/shm;
    ln -s /run/shm /dev/shm;
    sudo ln -s -f bash /bin/sh;
    bash continuous-integration/travis/install.sh;
    export PATH="$HOME/miniconda/miniconda/bin:$PATH";
    source activate test-environment;
    pip install -r requirements.txt;
    which python;
    conda list"

# Run test
script:
  - travis_wait 120 sleep infinity &
    docker exec -t ubuntu-test bash -c "
    export PATH="$HOME/miniconda/miniconda/bin:$PATH";
    source activate test-environment;
    coverage run --source=aligner setup.py test;"

# Calculate coverage
after_success:
  - coveralls

